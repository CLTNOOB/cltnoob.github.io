<!DOCTYPE html>
<html lang="pt-BR">
<head><!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-H81BYYMM81"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-H81BYYMM81');
</script>
<meta charset="UTF-8">
<title>SimulaÃ§Ã£o de NegÃ³cios</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:Arial,Helvetica,sans-serif;background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);color:#fff}
header{text-align:center;padding:20px;background:rgba(0,0,0,.3)}
main{padding:25px;max-width:1200px;margin:auto}
.card{background:rgba(255,255,255,.08);border-radius:12px;padding:20px;margin-bottom:20px;box-shadow:0 10px 30px rgba(0,0,0,.3)}
.stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px}
.stat{background:rgba(0,0,0,.35);padding:15px;border-radius:10px;text-align:center}
button{padding:12px;border:none;border-radius:8px;cursor:pointer;background:#00c6ff;font-weight:bold;width:100%;margin-top:10px}
button:hover{background:#00a8dd}
button:disabled{opacity:.55;cursor:not-allowed}
.hidden{display:none} 
/* --- Tutorial overlay styles --- */
#tutorialOverlay{position:fixed;inset:0;background:rgba(0,0,0,0.75);display:flex;align-items:center;justify-content:center;z-index:9999}
#tutorialOverlay.hidden{display:none}
#tutorialBox{background:linear-gradient(180deg,#1b2630,#12212a);padding:20px;border-radius:12px;width:90%;max-width:700px;color:#fff;box-shadow:0 20px 60px rgba(0,0,0,.6)}
#tutorialSteps{min-height:80px}
.tutorialNav{display:flex;gap:10px;justify-content:flex-end;margin-top:12px}
.tutorialBtn{background:#00c6ff;color:#002a33;padding:8px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:bold}
.tutorialBtn.secondary{background:#fff;color:#002a33}
#tutorialProgress{font-size:13px;color:#ccc;margin-bottom:8px}
/* ------------------------------- */
.arrows{position:fixed;bottom:20px;right:20px;display:flex;flex-direction:column;gap:10px}
.arrow{width:50px;height:50px;border-radius:50%;font-size:20px}
#graph{height:200px;background:#000;margin-top:15px;position:relative;overflow:hidden}
#chart{width:100%;height:200px;background:#000;border-radius:6px;display:block}
.trendUp{color:#0f0}
.trendDown{color:#f33}
.trendNeutral{color:#ccc}
#tradeInfo{background:rgba(255,255,255,0.03);border-radius:8px}
#closeTrade{width:100%}
/* O canvas Ã© desenhado por JS; a linha muda de cor conforme a direÃ§Ã£o atual */ 
</style>
</head>
<body>
<header>
<h1>ğŸ’¼ Simulador de NegÃ³cios</h1>
<p>Sistemas avanÃ§ados</p>
</header>
<main>

<div class="card" id="painelPrincipal">
<div class="stats">
<div class="stat">ğŸ’° Dinheiro<br><strong id="money">0</strong></div>
<div class="stat">ğŸ“ˆ Renda / clique<br><strong id="income">1</strong></div>
<div class="stat">ğŸ¢ NÃ­vel<br><strong id="level">1</strong></div>
<div class="stat">ğŸ¦ Renda Passiva<br><strong id="passive">0</strong></div>
</div>
<button onclick="ganharDinheiro()">Ganhar dinheiro</button>
  <button id="upgradeBtn" onclick="upgrade()">Upgrade (custo <span id="upgradeCost">100</span>)</button>
<button onclick="abrir('investimentos')">Investimentos</button>
<button onclick="abrir('graficos')">GrÃ¡ficos</button>
<button onclick="abrir('loja')">Loja</button>
<button onclick="abrir('galeria')">Galeria</button>

<!-- Sistema de salvamento manual / export / import -->
<button onclick="salvar()">ğŸ’¾ Salvar (local)</button>
<button onclick="exportarSave()">â¬‡ï¸ Exportar Save</button>
<input id="importFile" class="hidden" type="file" accept="application/json" onchange="importarSave(event)">
<button onclick="document.getElementById('importFile').click()">â¬†ï¸ Importar Save</button>
<button onclick="apagarSave()">ğŸ—‘ï¸ Apagar Save</button>
<button onclick="showTutorial(true)">ğŸ“ Tutorial</button>
</div>

<div class="card hidden" id="investimentos">
<h2>ğŸ¦ Investimentos</h2>
<div class="stat">ğŸ  Casa Alugada<br>Custo: 5.000<br>Retorno: +50 / 30s<button onclick="comprarInvestimento(5000,50)">Comprar</button></div>
<div class="stat" style="margin-top:10px">ğŸª Loja<br>Custo: 15.000<br>Retorno: +150 / 30s<button onclick="comprarInvestimento(15000,150)">Comprar</button></div>
<div class="stat" style="margin-top:10px">ğŸ¢ PrÃ©dio<br>Custo: 50.000<br>Retorno: +500 / 30s<button onclick="comprarInvestimento(50000,500)">Comprar</button></div>

<!-- Novos investimentos -->
<div class="stat" style="margin-top:10px">ğŸ“ˆ Fundo de AÃ§Ãµes<br>Custo: 8.000<br>Retorno: +90 / 30s<button onclick="comprarInvestimento(8000,90)">Comprar</button></div>
<div class="stat" style="margin-top:10px">ğŸ’³ TÃ­tulos PÃºblicos<br>Custo: 20.000<br>Retorno: +220 / 30s<button onclick="comprarInvestimento(20000,220)">Comprar</button></div>
<div class="stat" style="margin-top:10px">ğŸª™ Criptomoeda<br>Custo: 12.000<br>Retorno: +170 / 30s<button onclick="comprarInvestimento(12000,170)">Comprar</button></div>
<div class="stat" style="margin-top:10px">ğŸš€ Startup<br>Custo: 60.000<br>Retorno: +650 / 30s<button onclick="comprarInvestimento(60000,650)">Comprar</button></div>
<div class="stat" style="margin-top:10px">ğŸ˜ï¸ Fundo ImobiliÃ¡rio<br>Custo: 35.000<br>Retorno: +350 / 30s<button onclick="comprarInvestimento(35000,350)">Comprar</button></div>

<!-- Novas casas (compram com funÃ§Ã£o dedicada para registrar na galeria) -->
<div style="margin-top:15px"><h3>ğŸ  Casas</h3></div>
<div class="stat">Casa Simples<br>Custo: 10.000<br>Retorno: +120 / 30s<button onclick="comprarCasa('Casa Simples',10000,120)">Comprar</button></div>
<div class="stat" style="margin-top:10px">Apartamento<br>Custo: 40.000<br>Retorno: +400 / 30s<button onclick="comprarCasa('Apartamento',40000,400)">Comprar</button></div>
<div class="stat" style="margin-top:10px">SÃ­tio<br>Custo: 80.000<br>Retorno: +800 / 30s<button onclick="comprarCasa('SÃ­tio',80000,800)">Comprar</button></div>
<div class="stat" style="margin-top:10px">Cobertura<br>Custo: 200.000<br>Retorno: +2200 / 30s<button onclick="comprarCasa('Cobertura',200000,2200)">Comprar</button></div>
<div class="stat" style="margin-top:10px">MansÃ£o<br>Custo: 800.000<br>Retorno: +10000 / 30s<button onclick="comprarCasa('MansÃ£o',800000,10000)">Comprar</button></div>

<button onclick="voltar()">â¬… Voltar</button>
</div>

<div class="card hidden" id="graficos">
<h2>ğŸ“Š Mercado (alto risco)</h2>
<p>Escolha o valor e a direÃ§Ã£o</p>
<input id="valorInvest" type="number" placeholder="Valor para investir" style="width:100%;padding:10px;border-radius:6px;border:none">
<div id="graph">
  <canvas id="chart" width="800" height="200"></canvas>
</div>
<div id="marketInfo" style="margin-top:8px">PreÃ§o: <strong id="marketPrice">100.00</strong> | TendÃªncia: <strong id="marketTrend">Neutro</strong> | Status: <span id="marketStatus">Pronto</span></div>

<!-- Painel de informaÃ§Ãµes e controle do trade -->
<div id="tradeControls" style="margin-top:10px">
  <div id="tradeInfo" class="stat" style="padding:10px">Nenhum trade aberto</div>
  <button id="closeTrade" class="hidden" onclick="pararTrade()" style="background:#ff5252;color:#fff;padding:10px;border-radius:8px;margin-top:8px">Fechar Trade</button>
  <div style="font-size:12px;color:#ccc;margin-top:6px">Clique em <strong>â¬†</strong> para abrir compra (up) ou <strong>â¬‡</strong> para venda (down). Encerre com <strong>Fechar Trade</strong>.</div>
</div>

<div class="arrows"> 
<button class="arrow tradeOpenBtn" onclick="investirGrafico('up')">â¬†</button>
<button class="arrow tradeOpenBtn" onclick="investirGrafico('down')">â¬‡</button>
</div>  
<div style="margin-top:10px">Resultado: <strong id="resultadoGrafico">0</strong></div>
<button onclick="voltar()">â¬… Voltar</button>
</div>

<div class="card hidden" id="loja">
<h2>ğŸ›’ Loja</h2>
<div class="stat">ğŸš— BMW<br>PreÃ§o: 120.000<button onclick="comprarVeiculo('BMW',120000)">Comprar</button></div>
<div class="stat" style="margin-top:10px">âœˆï¸ AviÃ£o<br>PreÃ§o: 1.000.000<button onclick="comprarVeiculo('AviÃ£o',1000000)">Comprar</button></div>
<div class="stat" style="margin-top:10px">ğŸï¸ Ferrari<br>PreÃ§o: 500.000<button onclick="comprarVeiculo('Ferrari',500000)">Comprar</button></div>
<div class="stat" style="margin-top:10px">ğŸï¸ Moto<br>PreÃ§o: 30.000<button onclick="comprarVeiculo('Moto',30000)">Comprar</button></div>
<div class="stat" style="margin-top:10px">ğŸšš CaminhÃ£o<br>PreÃ§o: 250.000<button onclick="comprarVeiculo('CaminhÃ£o',250000)">Comprar</button></div>
<div class="stat" style="margin-top:10px">â›µ Barco<br>PreÃ§o: 350.000<button onclick="comprarVeiculo('Barco',350000)">Comprar</button></div>
<div class="stat" style="margin-top:10px">ğŸ”‹ Tesla<br>PreÃ§o: 220.000<button onclick="comprarVeiculo('Tesla',220000)">Comprar</button></div>
<button onclick="voltar()">â¬… Voltar</button>
</div>

<div class="card hidden" id="galeria">
<h2>ğŸ–¼ï¸ Galeria</h2>
<button onclick="mostrarGaleria('veiculos')">VeÃ­culos</button>
<button onclick="mostrarGaleria('casas')">Casas</button>
<div id="listaGaleria" style="margin-top:15px"></div>
<button onclick="voltar()">â¬… Voltar</button>
</div>

<!-- Tutorial overlay (aparece apenas na primeira vez) -->
<div id="tutorialOverlay" class="hidden">
  <div id="tutorialBox">
    <h2>ğŸ“ Tutorial inicial</h2>
    <div id="tutorialProgress"></div>
    <div id="tutorialSteps"></div>
    <div class="tutorialNav">
      <button class="tutorialBtn secondary" onclick="prevTutorial()">â—€ï¸ Anterior</button>
      <button class="tutorialBtn" onclick="nextTutorial()">PrÃ³ximo â–¶ï¸</button>
      <button class="tutorialBtn" onclick="startGame()" id="tutorialSkip">Pular</button>
    </div>
  </div>
</div>

</main>
<script>
const MAX_UPGRADE_LEVEL = 100;
let dinheiro=0,renda=1,nivel=1,rendaPassiva=0,custoUpgrade=100;
let veiculosComprados=[],casasCompradas=[],isInvesting=false;

// ==========================
// ParÃ¢metros de mercado (fÃ¡cil de alterar)
// ==========================
const initialPrice = 100.00;        // preÃ§o inicial
const updateInterval = 500;         // ms entre atualizaÃ§Ãµes de preÃ§o (ex: 500ms)
const percentRange = 1.5;           // variaÃ§Ã£o mÃ¡xima percentual por tick (+/- percentRange)
const trendMinSec = 4;              // duraÃ§Ã£o mÃ­nima de uma tendÃªncia (segundos)
const trendMaxSec = 12;             // duraÃ§Ã£o mÃ¡xima de uma tendÃªncia (segundos)
const volatility = 1.0;             // multiplicador de volatilidade (ajusta amplitude)
const historyMax = 120;             // nÃºmero de pontos do grÃ¡fico visÃ­veis

// Estado do mercado
let marketPriceVal = initialPrice;
let priceHistory = Array(historyMax).fill(initialPrice);
let trend = { type: 'neutral', expiresAt: 0 };

// VariÃ¡veis de animaÃ§Ã£o e desenho
const canvas = document.getElementById('chart');
const ctx = canvas.getContext('2d');
let anim = { startPrice: marketPriceVal, endPrice: marketPriceVal, startTime: 0, duration: updateInterval };

// Estado de trade
let tradeStartPrice = 0, tradeStake = 0, tradeDir = null;

// Atualiza valores visuais e salva (sem forÃ§ar saltos no grÃ¡fico)
function atualizar(){
  money.innerText = dinheiro;
  income.innerText = renda;
  level.innerText = nivel;
  passive.innerText = rendaPassiva;
  // Mostrar custo ou indicar que chegou ao nÃ­vel mÃ¡ximo
  if (nivel >= MAX_UPGRADE_LEVEL){
    upgradeCost.innerText = 'MAX';
    const btn = document.getElementById('upgradeBtn'); if (btn) btn.disabled = true;
  } else {
    upgradeCost.innerText = custoUpgrade;
    const btn = document.getElementById('upgradeBtn'); if (btn) btn.disabled = false;
  }
  marketPrice.innerText = marketPriceVal.toFixed(2);
  marketTrend.innerText = trend.type.charAt(0).toUpperCase() + trend.type.slice(1);
  salvar();
}

// ==========================
// Motor de mercado (tendÃªncias e atualizaÃ§Ã£o periÃ³dica)
// ==========================
// Inicia mercado e ciclo de tendÃªncias
function startMarket(){
  // popular histÃ³rico se estiver vazio
  if(!priceHistory || priceHistory.length < historyMax) priceHistory = Array(historyMax).fill(marketPriceVal);
  scheduleNextTrend();
  scheduleTick();
  anim.startTime = performance.now();
  requestAnimationFrame(animate);
}

// Schedule a next trend cycle
function scheduleNextTrend(){
  const types = ['up','neutral','down'];
  // chance diferente: priorizar neutro e alta ligeiramente
  const r = Math.random();
  let t;
  if(r < 0.40) t = 'up';
  else if(r < 0.75) t = 'neutral';
  else t = 'down';
  const dur = (Math.random() * (trendMaxSec - trendMinSec) + trendMinSec) * 1000; // ms
  trend.type = t;
  trend.expiresAt = Date.now() + dur;
  // ao fim da duraÃ§Ã£o, agenda prÃ³xima tendÃªncia
  setTimeout(scheduleNextTrend, dur);
}

// Agende o prÃ³ximo tick de preÃ§o
function scheduleTick(){
  setTimeout(()=>{
    tickPrice();
    scheduleTick();
  }, updateInterval);
}

// Calcula novo preÃ§o baseado em tendÃªncia, ruÃ­do e volatilidade
function tickPrice(){
  // base random percentual entre -percentRange e +percentRange
  const base = (Math.random() * 2 - 1) * percentRange;
  // bias do trend: torna mais provÃ¡vel movimento na direÃ§Ã£o da tendÃªncia
  let bias = 0;
  if(trend.type === 'up') bias = Math.random() * (percentRange*0.6); // positive bias
  else if(trend.type === 'down') bias = -Math.random() * (percentRange*0.6); // negative bias
  // final percent considerando volatilidade
  const pct = (base + bias) * volatility;
  const newPrice = Math.max(0.01, marketPriceVal * (1 + pct/100));

  // Shift histÃ³rico
  priceHistory.push(newPrice);
  if(priceHistory.length > historyMax) priceHistory.shift();

  // ajustar animaÃ§Ã£o para transiÃ§Ã£o suave entre valores
  anim.startPrice = marketPriceVal;
  anim.endPrice = newPrice;
  anim.startTime = performance.now();
  anim.duration = updateInterval;

  marketPriceVal = newPrice;
  atualizar();
}

// Desenho e animaÃ§Ã£o contÃ­nua (requestAnimationFrame)
function animate(now){
  // interpolar Ãºltimo ponto para suavizar movimento
  let t = Math.min(1, (now - anim.startTime) / anim.duration);
  // usar ease in-out para suavizar
  const ease = (t*(2-t));
  const displayedLast = anim.startPrice + (anim.endPrice - anim.startPrice) * ease;

  // construir array de y-values a desenhar (substitui Ãºltimo item por displayedLast)
  const drawData = priceHistory.slice();
  drawData[drawData.length - 1] = displayedLast;

  drawChart(drawData);
  // atualizar informaÃ§Ãµes do trade em tempo real (P&L nÃ£o realizado)
  updateTradeInfo();
  requestAnimationFrame(animate);
}

// Desenha o grÃ¡fico no canvas (linha, cor conforme direÃ§Ã£o instantÃ¢nea)
function drawChart(data){
  const w = canvas.width = canvas.clientWidth;
  const h = canvas.height = canvas.clientHeight;

  // cleared background (fundo escuro)
  ctx.fillStyle = '#0a0a0a';
  ctx.fillRect(0,0,w,h);

  // calcular domÃ­nio vertical
  const min = Math.min(...data);
  const max = Math.max(...data);
  const pad = (max - min) * 0.1 + 0.0001;
  const vmin = min - pad;
  const vmax = max + pad;

  // mapeamento price -> y
  const priceToY = p => h - ((p - vmin) / (vmax - vmin)) * h;

  // decidir cor pela variaÃ§Ã£o recente
  const last = data[data.length-1];
  const prev = data[data.length-2] || last;
  const slopeUp = (last - prev) >= 0;
  ctx.lineWidth = 2;
  ctx.strokeStyle = slopeUp ? '#4caf50' : '#ff5252';
  ctx.beginPath();
  for(let i=0;i<data.length;i++){
    const x = (w * i) / (data.length - 1);
    const y = priceToY(data[i]);
    if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
  }
  ctx.stroke();

  // small marker for last price
  ctx.fillStyle = slopeUp ? '#4caf50' : '#ff5252';
  ctx.beginPath();
  const lx = w * (data.length - 1) / (data.length - 1);
  const ly = priceToY(last);
  ctx.arc(lx, ly, 3, 0, Math.PI*2);
  ctx.fill();
}

// ==========================
// Trade: abrir, fechar manualmente e calcular resultado
// ==========================
function investirGrafico(dir){
  if(isInvesting) return alert('JÃ¡ existe um trade em execuÃ§Ã£o');
  const v = Number(valorInvest.value);
  if(!v || v<=0 || v>dinheiro) return alert('Valor invÃ¡lido');
  // abrir posiÃ§Ã£o
  isInvesting = true;
  tradeStake = v;
  tradeDir = dir;
  tradeStartPrice = marketPriceVal;
  dinheiro -= v;
  // desabilita apenas os botÃµes de abrir trade (mantÃ©m botÃ£o de fechar ativo)
  document.querySelectorAll('.tradeOpenBtn').forEach(b=>b.disabled=true);
  document.getElementById('closeTrade').classList.remove('hidden');
  marketStatus.innerText = 'Trade Aberto';
  atualizar();
  updateTradeInfo();
}

// atualiza info do trade em tempo real (chamar dentro do loop de animaÃ§Ã£o ou ao mudar preÃ§o)
function updateTradeInfo(){
  const info = document.getElementById('tradeInfo');
  if(!isInvesting){
    info.innerHTML = 'Nenhum trade aberto';
    document.getElementById('closeTrade').classList.add('hidden');
    return;
  }

  const dirTxt = tradeDir === 'up' ? 'Compra (UP)' : 'Venda (DOWN)';
  const percentChange = (marketPriceVal - tradeStartPrice) / tradeStartPrice;
  const effectivePercent = (tradeDir === 'up') ? percentChange : -percentChange;

  const unrealized = Number((tradeStake * effectivePercent).toFixed(2));
  const sign = unrealized >= 0 ? '+' : '';

  info.innerHTML = `
    Trade: ${dirTxt}<br>
    Abertura: ${tradeStartPrice.toFixed(2)} | Stake: ${tradeStake}<br>
    P&L Atual: <strong style="color:${unrealized>=0?"#4caf50":"#ff5252"}">
      ${sign}${unrealized}
    </strong>
  `;

  const closeBtn = document.getElementById('closeTrade');
  closeBtn.textContent = `Fechar Trade â€” ${sign}${unrealized}`;
  closeBtn.style.background = unrealized >= 0 ? '#2e7d32' : '#b00020';
}



function pararTrade(){
  if(!isInvesting) return; // nada a fechar
  finalizarTrade();
}

function finalizarTrade(){
  // calcula mudanÃ§a percentual efetiva
  const percentChange = (marketPriceVal - tradeStartPrice) / tradeStartPrice;
  const effectivePercent = (tradeDir === 'up') ? percentChange : -percentChange;
  const ganho = Math.floor(tradeStake * effectivePercent);
  dinheiro += tradeStake + ganho;
  resultadoGrafico.innerText = ganho;
  marketStatus.innerText = ganho >= 0 ? 'Ganhou' : 'Perdeu';
  setTimeout(()=>{ marketStatus.innerText = 'Pronto'; }, 1200);
  // reabilita os botÃµes de abrir trade
  document.querySelectorAll('.tradeOpenBtn').forEach(b=>b.disabled=false);
  document.getElementById('closeTrade').classList.add('hidden');
  isInvesting = false; tradeStake = 0; tradeDir = null; tradeStartPrice = marketPriceVal;
  updateTradeInfo();
  atualizar();
} 
function ganharDinheiro(){dinheiro+=renda;atualizar();}
function upgrade(){
  if (nivel >= MAX_UPGRADE_LEVEL) return alert('VocÃª jÃ¡ atingiu o nÃ­vel mÃ¡ximo');
  if(dinheiro>=custoUpgrade){
    dinheiro-=custoUpgrade;
    renda += 1 + Math.floor(nivel * 0.1);
    nivel++;
    custoUpgrade=Math.floor(custoUpgrade * 1.085);
    atualizar();
  } else alert('Dinheiro insuficiente');
}
function comprarInvestimento(c,r){if(dinheiro>=c){dinheiro-=c;rendaPassiva+=r;atualizar();}else alert('Dinheiro insuficiente');}
function comprarCasa(name,c,r){if(dinheiro>=c){dinheiro-=c;rendaPassiva+=r;casasCompradas.push({nome:name,preco:c});atualizar();}else alert('Dinheiro insuficiente');}
function comprarVeiculo(n,p){if(dinheiro>=p){dinheiro-=p;veiculosComprados.push({nome:n,preco:p});atualizar();}else alert('Dinheiro insuficiente');} 
function abrir(id){painelPrincipal.classList.add('hidden');document.getElementById(id).classList.remove('hidden');}
function voltar(){document.querySelectorAll('.card').forEach(c=>c.classList.add('hidden'));painelPrincipal.classList.remove('hidden');}
function mostrarGaleria(t){
  let h='';
  if(t==='veiculos'){
    veiculosComprados.forEach(v=>h+=`ğŸš— ${v.nome} - ${v.preco}<br>`);
  } else if(t==='casas'){
    casasCompradas.forEach(c=>h+=`ğŸ  ${c.nome} - ${c.preco}<br>`);
  }
  listaGaleria.innerHTML = h || 'Nada comprado';
}

// (Trecho antigo de trade removido â€” trade agora usa o motor de mercado contÃ­nuo)
/* =========================
   SAVE / LOAD + OFFLINE
   ========================= */

const OFFLINE_LIMIT = 24 * 60 * 60 * 1000; // 24h

// renda passiva a cada 30s (online)
setInterval(()=>{
  dinheiro += rendaPassiva;
  atualizar();
}, 30000);

function salvar(){
  localStorage.setItem('save', JSON.stringify({
    dinheiro,
    renda,
    nivel,
    rendaPassiva,
    custoUpgrade,
    veiculosComprados,
    casasCompradas,
    marketPriceVal,
    lastSave: Date.now()
  }));
}

function carregar(){
  const raw = localStorage.getItem('save');
  if(!raw) return;

  try{
    const s = JSON.parse(raw);

    dinheiro = s.dinheiro || 0;
    renda = s.renda || 1;
    nivel = s.nivel || 1;
    rendaPassiva = s.rendaPassiva || 0;
    custoUpgrade = s.custoUpgrade || 100;
    veiculosComprados = s.veiculosComprados || [];
    casasCompradas = s.casasCompradas || [];
    marketPriceVal = s.marketPriceVal || initialPrice;

    priceHistory = Array(historyMax).fill(marketPriceVal);

    /* ===== GANHOS OFFLINE ===== */
    if(s.lastSave){
      const agora = Date.now();
      let tempoOffline = Math.min(agora - s.lastSave, OFFLINE_LIMIT);
      const ciclos = Math.floor(tempoOffline / 30000);
      const ganhoOffline = ciclos * rendaPassiva;
      dinheiro += ganhoOffline;
    }

    salvar(); // atualiza timestamp e evita exploit

  }catch(e){
    console.warn('Save invÃ¡lido', e);
  }
}



function exportarSave(){salvar();const data=localStorage.getItem('save');const blob=new Blob([data],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='sim_save.json';a.click();URL.revokeObjectURL(url);}
function importarSave(e){const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=()=>{try{const s=JSON.parse(r.result);dinheiro=s.dinheiro||0;renda=s.renda||1;nivel=s.nivel||1;rendaPassiva=s.rendaPassiva||0;custoUpgrade=s.custoUpgrade || 100;veiculosComprados=s.veiculosComprados||[];casasCompradas=s.casasCompradas||[];marketPriceVal = s.marketPriceVal || initialPrice; priceHistory = Array(historyMax).fill(marketPriceVal);salvar();atualizar();alert('Save importado com sucesso!');}catch(err){alert('Arquivo invÃ¡lido');}};r.readAsText(f);e.target.value='';}
function apagarSave(){if(confirm('Apagar save?')){localStorage.removeItem('save');dinheiro=0;renda=1;nivel=1;rendaPassiva=0;custoUpgrade=100;veiculosComprados=[];casasCompradas=[];marketPriceVal = initialPrice; priceHistory = Array(historyMax).fill(marketPriceVal);atualizar();alert('Save apagado');}}

/* Tutorial inicial (mostra apenas na primeira vez) */
const tutorialSteps = [
  'Bem-vindo ao Simulador de NegÃ³cios! Clique em "Ganhar dinheiro" para obter sua primeira renda.',
  'Use "Upgrade" para aumentar sua renda por clique e subir de nÃ­vel.',
  'Acesse "Investimentos" para comprar ativos que geram renda passiva automaticamente.',
  'Na aba "GrÃ¡ficos" vocÃª pode abrir trades de alto risco; use as setas para abrir e "Fechar Trade" para encerrar.',
  'Abra "Loja" e "Galeria" para comprar itens e ver suas compras. Boa sorte!'
];
let tutorialIndex = 0;
function renderTutorial(){
  const tutorialOverlay = document.getElementById('tutorialOverlay');
  const tutorialStepsEl = document.getElementById('tutorialSteps');
  const tutorialProg = document.getElementById('tutorialProgress');
  const prevBtn = document.querySelector('.tutorialBtn.secondary');
  const nextBtn = document.querySelector('.tutorialBtn:not(.secondary)');
  const skipBtn = document.getElementById('tutorialSkip');
  if(!tutorialOverlay || !tutorialStepsEl || !tutorialProg) return;
  tutorialStepsEl.innerText = tutorialSteps[tutorialIndex];
  tutorialProg.innerText = `Passo ${tutorialIndex+1} de ${tutorialSteps.length}`;
  prevBtn.disabled = tutorialIndex===0;
  if(tutorialIndex === tutorialSteps.length - 1){
    nextBtn.style.display = 'none';
    skipBtn.textContent = 'ComeÃ§ar';
  }else{
    nextBtn.style.display = '';
    skipBtn.textContent = 'Pular';
  }
}
function showTutorial(force=false){
  if(!force && localStorage.getItem('tutorial_seen')) return;
  tutorialIndex = 0;
  const tutorialOverlay = document.getElementById('tutorialOverlay');
  if(!tutorialOverlay) return;
  tutorialOverlay.classList.remove('hidden');
  renderTutorial();
}
function nextTutorial(){ if(tutorialIndex < tutorialSteps.length - 1){ tutorialIndex++; renderTutorial(); } else closeTutorial(true); }
function prevTutorial(){ if(tutorialIndex>0){ tutorialIndex--; renderTutorial(); } }
function closeTutorial(markSeen=false){
  const tutorialOverlay = document.getElementById('tutorialOverlay');
  if(tutorialOverlay) tutorialOverlay.classList.add('hidden');
  if(markSeen) localStorage.setItem('tutorial_seen','1');
}

function startGame(){
  // Fecha o tutorial e marca como visto
  closeTutorial(true);
  // DÃ¡ um pequeno bÃ´nus inicial apenas uma vez
  if(!localStorage.getItem('tutorial_bonus_given')){
    dinheiro += 10;
    atualizar();
    localStorage.setItem('tutorial_bonus_given','1');
  }
  // Foca no botÃ£o de ganhar dinheiro para orientar o jogador
  const btn = document.querySelector('button[onclick="ganharDinheiro()"]');
  if(btn) btn.focus();
}

carregar();
startMarket();
atualizar();
</script>
</body>
</html>







